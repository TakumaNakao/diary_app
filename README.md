# Diary App

個人的な日記を管理・記録するためのWebアプリケーションです。日々の出来事や思考を記録し、タグで分類・検索することができます。

## ✨ 主な機能

### 📝 日記の作成・編集
- カレンダーから日付を選択して日記を作成
- **強化されたMarkdownエディタ**による豊かな表現
  - リアルタイムプレビュー機能
  - **数式サポート**（KaTeX）
  - **シンタックスハイライト**（コードブロック）
  - GitHub Flavored Markdown対応
- 1日に複数のエントリーを記録可能
- **エントリー間の内部リンク機能**
  - 他のエントリーへのリンクを簡単に挿入
  - リンクをクリックして関連エントリーに移動

### 🖼️ 画像添付機能
- **複数の画像をエントリーに添付可能**
- **IndexedDB**による効率的な画像ストレージ
  - ブラウザの容量制限内で大容量の画像を保存
  - オフラインでも画像が利用可能
- **Markdownインライン表示**
  - エディタ内で`![Image](diary-image:ID)`形式で挿入
  - プレビューモードで画像を自動レンダリング
- **自動画像管理**
  - 使用されていない画像は自動的にクリーンアップ
  - ストレージの効率的な利用

### 📌 ピン留め機能
- 重要なエントリーをピン留めして素早くアクセス
- ピン留めしたエントリーの一覧表示
- ワンクリックでピン留めのオン/オフを切り替え

### 📋 テンプレート機能
- よく使う日記のフォーマットをテンプレートとして保存
- テンプレートから新しいエントリーを素早く作成
- テンプレートの作成・編集・削除
- テンプレート一覧から選択して適用

### 🏷️ タグ管理
- 階層構造のタグシステム
- 親タグと子タグの関係性
- タグごとの色分け（5段階の濃淡調整可能）
- 子タグは親タグの色を自動継承
- タグごとのエントリー一覧表示

### 🔍 検索機能
- **Fuse.jsによるファジー検索**（あいまい検索）
- 全文検索（タイトル・本文）
- タグによる絞り込み
- 日付範囲指定
- 複数条件の組み合わせ検索
- **検索結果のMarkdownプレビュー**
  - 検索結果でエントリーの内容をプレビュー表示
  - 画像も含めた内容確認が可能

### 📅 カレンダービュー
- 月間カレンダー表示
- エントリーがある日を視覚的に確認
- 日付をクリックして直接その日の日記にアクセス

### 🌙 ダークモード
- ライト/ダークモードの切り替え
- 目に優しい配色
- ユーザーの好みに合わせたテーマ選択

### 💾 データ保存
- **IndexedDB**による大容量データストレージ
  - 画像データを効率的に保存
  - LocalStorageの容量制限を解消
- **LocalStorage**によるメタデータ管理
  - エントリーのテキストデータ、タグ、テンプレート
- サーバー不要でオフラインでも動作
- すべてのデータをローカルで管理

## 🚀 デプロイ

このアプリケーションは**GitHub Pages**にデプロイ可能です。

### 自動デプロイ
- `main`ブランチへのプッシュで自動的にGitHub Pagesにデプロイ
- GitHub Actionsによる自動ビルド・デプロイ

### 手動デプロイ
GitHub Actionsの「Deploy to GitHub Pages」ワークフローを手動で実行することもできます。

## 🛠️ 技術スタック

- **フロントエンド**: React 19
- **ルーティング**: React Router v7
- **スタイリング**: CSS（カスタムプロパティ使用）
- **Markdownエディター**: 
  - `react-markdown`: Markdown レンダリング
  - `remark-gfm`: GitHub Flavored Markdown
  - `remark-math` & `rehype-katex`: 数式サポート
  - `react-syntax-highlighter`: シンタックスハイライト
- **アイコン**: Lucide React
- **検索**: Fuse.js（ファジー検索）
- **ユニークID生成**: uuid
- **ビルドツール**: Vite
- **ストレージ**: 
  - IndexedDB（Dexie.js）- 画像データ
  - LocalStorage API - メタデータ
- **デプロイ**: GitHub Pages & GitHub Actions

## 📦 セットアップ

### 必要な環境
- Node.js 16.0以上
- npm または yarn

### インストール

1. リポジトリをクローン
```bash
git clone <repository-url>
cd diary_app
```

2. 依存パッケージをインストール
```bash
npm install
```

## 🏃 起動方法

### 開発サーバーの起動
```bash
npm run dev
```

ブラウザで `http://localhost:5173` を開くとアプリケーションが表示されます。

### プロダクションビルド
```bash
npm run build
```

ビルドされたファイルは `dist` ディレクトリに出力されます。

### プレビュー
```bash
npm run preview
```

ビルドされたアプリケーションをローカルでプレビューできます。

## 📖 使い方

### 1. 日記を作成する
1. カレンダーから日付を選択
2. 「+ New Entry」ボタンをクリック
3. タイトルと本文を入力（Markdown記法が使えます）
4. 必要に応じてタグを追加
5. テンプレートを使う場合は、テンプレート一覧から選択
6. 「Save」ボタンで保存

### 2. 画像を添付する
1. エントリー編集画面で「Image」ボタンをクリック
2. 画像ファイルを選択（複数選択可能）
3. 画像がMarkdown形式で自動挿入される
4. プレビューモードで画像の表示を確認

### 3. タグを管理する
1. サイドバーの「Manage Tags」をクリック
2. 「New Root Tag」で新しいタグを作成
3. タグの色と濃淡を選択
4. 子タグを作成する場合は、親タグの「Add Child」をクリック

### 4. 日記を検索する
1. サイドバーの「Search」をクリック
2. キーワード、タグ、日付範囲を指定
3. 「検索」ボタンをクリック
4. 検索結果から気になるエントリーをクリック

### 5. テンプレートを使う
1. サイドバーの「Templates」をクリック
2. 「+ New Template」で新しいテンプレートを作成
3. エントリー作成時にテンプレート一覧からテンプレートを選択して適用

### 6. エントリーをピン留めする
1. エントリー編集画面でピンアイコンをクリック
2. サイドバーの「Pinned」からピン留めしたエントリー一覧にアクセス

## 📁 プロジェクト構成

```
diary_app/
├── .github/
│   └── workflows/
│       └── deploy.yml       # GitHub Actions デプロイ設定
├── src/
│   ├── components/          # Reactコンポーネント
│   │   ├── Calendar/        # カレンダービュー
│   │   ├── DailyLog/        # 日次ログ表示
│   │   ├── Editor/          # Markdownエディター
│   │   │   └── LinkInserter.jsx # リンク挿入モーダル
│   │   ├── EnhancedMarkdown/ # 拡張Markdownレンダラー
│   │   ├── EntryList/       # エントリーリスト
│   │   ├── Layout/          # レイアウト・ナビゲーション
│   │   ├── PinnedEntries/   # ピン留めエントリー
│   │   ├── Search/          # 検索機能
│   │   ├── TagManager/      # タグ管理
│   │   └── Templates/       # テンプレート機能
│   ├── context/             # React Context
│   │   ├── DiaryContext.jsx # 日記データ状態管理
│   │   ├── ThemeContext.jsx # テーマ（ダークモード）管理
│   │   └── TemplateContext.jsx # テンプレート管理
│   ├── utils/               # ユーティリティ
│   │   ├── color.js         # 色関連の処理
│   │   ├── colorUtils.js    # 色変換ユーティリティ
│   │   └── storage.js       # IndexedDB (Dexie) 操作ラッパー
│   ├── db.js                # Dexie (IndexedDB) 設定
│   ├── App.jsx              # アプリケーションルート
│   ├── main.jsx             # エントリーポイント
│   └── index.css            # グローバルスタイル
├── public/                  # 静的ファイル
├── index.html               # HTMLテンプレート
├── vite.config.js           # Vite設定
└── package.json             # パッケージ情報
```

## 💡 データの保存場所

### LocalStorage
以下のデータはLocalStorageに保存されます：
- **テーマ設定**: キー `diary-theme`

### IndexedDB (Dexie)
以下のデータはIndexedDBに保存されます（データベース名: `DiaryDatabase`）：
- **エントリーデータ**: テーブル `entries`
- **タグ**: テーブル `tags`
- **テンプレート**: テーブル `templates`
- **画像データ**: テーブル `images`
  - 各画像: ID, entryId, blob（画像バイナリ）, mimeType

データをバックアップする場合：
- LocalStorageデータ: 開発者ツールからlocalStorageの内容をエクスポート
- IndexedDBデータ: ブラウザの IndexedDB からエクスポート（Dexie.jsのエクスポート機能などの実装が必要）

## 📝 ライセンス

MIT License

## 🔮 今後の追加予定機能

- [x] ~~画像添付機能~~ ✅ 実装済み
- [ ] データのエクスポート/インポート機能（JSON/Markdown形式）
  - 画像を含む完全なバックアップ機能
- [ ] PWA化（オフライン対応・インストール可能）
- [ ] 統計・振り返り機能（月次レポート、タグ統計など）
- [ ] 感情トラッキング機能
- [ ] エントリーの並び替え・フィルタリング機能の拡張
- [ ] データ同期機能（クラウドストレージ連携）
- [ ] 画像の編集・トリミング機能
- [ ] 画像キャプション機能

## 🐛 既知の問題

現在、既知の問題はありません。問題を見つけた場合は、Issuesで報告してください。

## 🤝 コントリビューション

プルリクエストを歓迎します。大きな変更の場合は、まずIssueを開いて変更内容を議論してください。
